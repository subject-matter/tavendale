{% extends "_layouts/layout.twig" %}
{% set newsCategories = craft.categories.group('news') %}
{% set featuredNews = null %}
{% set newsList = craft.entries().section('newsPage') %}
{% if entry is not defined %}
    {% set entry = craft.entries({section: 'newInsights'}).one() %}
{% endif %}

{% if category is not defined %}
    {% set featuredNews = newsList.one() %}
    {% set newsList = newsList.id('and, not ' ~ featuredNews.id) %}
{% else %}
    {% set newsList = newsList.relatedTo(category) %}
{% endif %}
{% paginate newsList.limit(6) as pageInfo, pageEntries %}


{% block template %}

    <div class="news-page">
        {% if featuredNews and pageInfo.currentPage == 1 %}
        <div class="container ">
            <div>
                <span class="text-xs font-headings">Latest Insight</span>
            </div>
            </div>

            <hr class="news-page__insight-split" />

            <div class="news-page__featured">
                <div class="container grid grid-cols-2 gap-3">
                    <div class="news-page__featured__img-holder relative">
                        <div class="news-page__featured__img"
                            {% if featuredNews.primaryImage.one() %}
                                style="background-image: url('{{ featuredNews.primaryImage.one().getUrl() }}');"
                            {% endif %}
                        ></div>

                        {% if featuredNews.newsCategories|length %}
                            <div class="news-page__item__categories font-headings">
                                <ul>
                                    {% for category in featuredNews.newsCategories.all() %}
                                        <li>
                                            {{ category.title }}
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                    </div>
                    <div class="news-page__featured__content">
                        <h6 class="mb-6">{{ featuredNews.title }}</h6>
                        {% if featuredNews.sectionPlainText %}
                            <div class="news-page__item__summary text-body-lg">
                                <p>{{ featuredNews.sectionPlainText }}</p>
                            </div>
                        {% endif %}
                        <a href="{{ featuredNews.getUrl() }}" class="btn btn--solid btn--white">
                            Read more
                        </a>
                    </div>
                </div>
            </div>

            <hr class="news-page__featured-split"/>
        {% endif %}

        <div class="news-page__switcher">
            <ul class="news-page__switcher-wrapper">

            <li>
                News
            </li>
            <li>
                Insights
            </li>
        </ul>

        </div>

        <div class="container grid grid-cols-12">
            <div class="col-span-3 flex flex-col justify-between items-start">
                <form action="">
                    <div class="field mb-2">
                        <div class="inner">
                            {% include "_svg/search" %}
                            <input type="text" name="search" placeholder="Quick Search">
                        </div>
                    </div>

                    <div class="field field--select">
                        <div class="inner">
                            <select class="category js-news-category" name="category">
                                <option value="{{ entry.getUrl() }}">Expertise</option>
                                {% for newsCategory in newsCategories.all() %}
                                    <option value="{{ newsCategory.url }}"
                                            {% if category is defined and newsCategory.slug == category.slug %} selected="selected"{% endif %}>
                                        {{ newsCategory.title }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </form>

                <a href="{{ pageInfo.nextUrl }}" class="btn btn--solid btn--white inline-block">
                    Load More
                </a>
            </div>
            <div class="col-span-9">

                <div class="news-page__list grid grid-cols-2 gap-3">
                    {% for page in pageEntries %}
                        <div class="news-page__item ">
                            <div >

                            <a href="{{ page.getUrl }}" class="news-page__item__inner">
                                <div class="news-page__item__image"
                                    {% if page.primaryImage.one() %}
                                        style="background-image: url('{{ page.primaryImage.one().getUrl() }}');"
                                    {% endif %}
                                >
                            </div>

                            <div class="news-page__item__content">
                            {% if page.newsCategories|length %}
                                <div class="news-page__item__categories font-headings">
                                    <ul>
                                        {% for category in page.newsCategories.all() %}
                                            <li>
                                                {{ category.title }}
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
    
                                <span class="text-body-lg mb-6 block font-headings">{{ page.title }}</span>
                                {% if page.sectionPlainText %}                                        
                                    <p>{{ page.sectionPlainText }}</p>
                                {% endif %}
                            </div>
                        </div>

                            <span class="news-page__read-more">Read More</span>

                            </a>
                            
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% include "_partials/blocks" %}
{% endblock %}